import React, { useEffect, useState } from "react";

// Shirley Temple Reviews - Single-file React component
// Tailwind CSS classes are used for styling (no imports required in this file).
// Default export a React component suitable for previewing on GitHub Pages or similar.

export default function ShirleyTempleReviews() {
  const [route, setRoute] = useState("reviews");
  const [showPasswordModal, setShowPasswordModal] = useState(false);
  const [passwordInput, setPasswordInput] = useState("");
  const [isAuthorized, setIsAuthorized] = useState(false);
  const [reviews, setReviews] = useState([]);

  // Form state for new review
  const [newTitle, setNewTitle] = useState("");
  const [newBody, setNewBody] = useState("");
  const [newRating, setNewRating] = useState(5);

  const LOCAL_KEY = "shirley_reviews_v1";
  const PASSWORD = "7679"; // the password provided by the user; client-side only

  useEffect(() => {
    // load reviews from localStorage
    try {
      const raw = localStorage.getItem(LOCAL_KEY);
      if (raw) setReviews(JSON.parse(raw));
      else {
        // seed with some friendly sample reviews
        const seeded = [
          {
            id: 1,
            title: "Classic and refreshing",
            body: "Sweet, bright, and perfect for kids (and adults who want nostalgia).",
            rating: 5,
            date: new Date().toISOString(),
          },
          {
            id: 2,
            title: "Too sweet for me",
            body: "I prefer something with less grenadine — very sugary but fun once in a while.",
            rating: 3,
            date: new Date().toISOString(),
          },
        ];
        setReviews(seeded);
        localStorage.setItem(LOCAL_KEY, JSON.stringify(seeded));
      }
    } catch (e) {
      console.error("Failed to load reviews:", e);
    }
  }, []);

  useEffect(() => {
    // persist reviews when they change
    try {
      localStorage.setItem(LOCAL_KEY, JSON.stringify(reviews));
    } catch (e) {
      console.error("Failed to save reviews:", e);
    }
  }, [reviews]);

  function handleOpenAdd() {
    setPasswordInput("");
    setShowPasswordModal(true);
  }

  function checkPassword() {
    if (passwordInput === PASSWORD) {
      setIsAuthorized(true);
      setShowPasswordModal(false);
    } else {
      alert("Incorrect password. Try again.");
    }
  }

  function handleAddReview(e) {
    e.preventDefault();
    if (!newTitle.trim() || !newBody.trim()) {
      alert("Please add a title and body for the review.");
      return;
    }
    const next = {
      id: Date.now(),
      title: newTitle.trim(),
      body: newBody.trim(),
      rating: Number(newRating),
      date: new Date().toISOString(),
    };
    setReviews([next, ...reviews]);
    // clear form
    setNewTitle("");
    setNewBody("");
    setNewRating(5);
    // navigate to reviews
    setRoute("reviews");
  }

  // simple components
  const Nav = () => (
    <header className="w-full sticky top-0 z-20 bg-white/60 backdrop-blur-md shadow-sm">
      <div className="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
        <h1 className="text-xl font-bold text-rose-600">Shirley Temple Reviews</h1>
        <nav className="space-x-3">
          <button
            onClick={() => setRoute("reviews")}
            className={`px-3 py-1 rounded-md ${route === "reviews" ? "bg-rose-100" : "hover:bg-gray-100"}`}
          >
            Reviews
          </button>
          <button
            onClick={() => setRoute("gallery")}
            className={`px-3 py-1 rounded-md ${route === "gallery" ? "bg-rose-100" : "hover:bg-gray-100"}`}
          >
            Gallery
          </button>
          <button
            onClick={() => setRoute("info")}
            className={`px-3 py-1 rounded-md ${route === "info" ? "bg-rose-100" : "hover:bg-gray-100"}`}
          >
            About Me
          </button>
          <button
            onClick={handleOpenAdd}
            className="ml-3 px-3 py-1 rounded-md bg-rose-500 text-white hover:opacity-95"
          >
            Add Post
          </button>
        </nav>
      </div>
    </header>
  );

  const ReviewsView = () => (
    <section className="max-w-5xl mx-auto p-6">
      <div className="flex items-center justify-between mb-4">
        <h2 className="text-2xl font-semibold">Reviews</h2>
        <div className="text-sm text-gray-600">{reviews.length} review(s)</div>
      </div>

      {isAuthorized ? (
        <form onSubmit={handleAddReview} className="mb-6 p-4 bg-white/70 rounded-2xl shadow-inner">
          <h3 className="font-semibold mb-2">Write a review</h3>
          <label className="block mb-2">
            <div className="text-xs text-gray-600">Title</div>
            <input value={newTitle} onChange={(e) => setNewTitle(e.target.value)} className="w-full rounded-md p-2 border" />
          </label>
          <label className="block mb-2">
            <div className="text-xs text-gray-600">Body</div>
            <textarea value={newBody} onChange={(e) => setNewBody(e.target.value)} className="w-full rounded-md p-2 border" rows={3} />
          </label>
          <label className="block mb-4">
            <div className="text-xs text-gray-600">Rating</div>
            <select value={newRating} onChange={(e) => setNewRating(e.target.value)} className="rounded-md p-2 border">
              {[5,4,3,2,1].map(n => <option key={n} value={n}>{n} / 5</option>)}
            </select>
          </label>
          <div className="flex gap-2">
            <button type="submit" className="px-4 py-2 bg-rose-500 text-white rounded-md">Publish</button>
            <button type="button" onClick={() => setIsAuthorized(false)} className="px-4 py-2 border rounded-md">Lock</button>
          </div>
        </form>
      ) : (
        <div className="mb-6 text-sm text-gray-700">To add a review press <strong>Add Post</strong> and enter the password.</div>
      )}

      <div className="grid gap-4">
        {reviews.map((r) => (
          <article key={r.id} className="p-4 bg-white/60 rounded-2xl shadow">
            <div className="flex items-center justify-between mb-1">
              <h4 className="font-semibold">{r.title}</h4>
              <div className="text-sm text-gray-600">{new Date(r.date).toLocaleString()}</div>
            </div>
            <div className="text-sm text-rose-600 mb-2">Rating: {r.rating} / 5</div>
            <p className="text-gray-800">{r.body}</p>
          </article>
        ))}
      </div>
    </section>
  );

  const GalleryView = () => (
    <section className="max-w-5xl mx-auto p-6">
      <h2 className="text-2xl font-semibold mb-4">Gallery</h2>
      <p className="mb-4 text-sm text-gray-700">Photos and fun Shirley Temple-inspired images.</p>
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
        {[
          "https://images.unsplash.com/photo-1551024601-bec78aea704b?q=80&w=1200&auto=format&fit=crop&crop=entropy",
          "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=1200&auto=format&fit=crop&crop=entropy",
          "https://images.unsplash.com/photo-1506368249639-73a05d6f6488?q=80&w=1200&auto=format&fit=crop&crop=entropy",
        ].map((src, i) => (
          <div key={i} className="rounded-2xl overflow-hidden shadow">
            <img alt={`gallery-${i}`} src={src} className="w-full h-48 object-cover" />
          </div>
        ))}
      </div>
    </section>
  );

  const InfoView = () => (
    <section className="max-w-5xl mx-auto p-6">
      <h2 className="text-2xl font-semibold mb-4">About Me</h2>
      <div className="p-4 bg-white/60 rounded-2xl shadow">
        <p className="mb-3">Hi — this is a lighthearted place where we share short reviews of Shirley Temple mocktails (and the nostalgia that comes with them). You can add a review if you know the site password.</p>
        <p className="text-sm text-gray-700">This site is a simple single-file React example intended for use on GitHub Pages. Reviews are stored locally in your browser (localStorage) so you can experiment without creating accounts.</p>
      </div>
    </section>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-rose-50 to-yellow-50 text-gray-900">
      <Nav />

      <main className="pt-6 pb-12">
        {route === "reviews" && <ReviewsView />}
        {route === "gallery" && <GalleryView />}
        {route === "info" && <InfoView />}
      </main>

      <footer className="w-full border-t mt-12">
        <div className="max-w-5xl mx-auto px-4 py-6 text-sm text-gray-600">Made with a friendly background • Shirley Temple Reviews</div>
      </footer>

      {/* Password modal */}
      {showPasswordModal && (
        <div className="fixed inset-0 flex items-center justify-center bg-black/40 z-30">
          <div className="bg-white rounded-2xl p-6 w-11/12 max-w-md">
            <h3 className="text-lg font-semibold mb-2">Enter password to add a post</h3>
            <input
              autoFocus
              type="password"
              value={passwordInput}
              onChange={(e) => setPasswordInput(e.target.value)}
              className="w-full p-2 border rounded-md mb-4"
              placeholder="Password"
            />
            <div className="flex gap-2 justify-end">
              <button onClick={() => setShowPasswordModal(false)} className="px-4 py-2 border rounded-md">Cancel</button>
              <button onClick={checkPassword} className="px-4 py-2 bg-rose-500 text-white rounded-md">Unlock</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
